SE MODIFICA LA TABLA DETALLE DE FACTURAS CON EL FIN DE INCLUIR LA CANTIDAD DE PARTES VENDIDAS 

ALTER TABLE DETALLE_FACTURAS 
ADD CANTIDAD_PARTES NUMBER(10); 

PUNTO 1 

SE CREA LA TABLA LOG DE HISTORICO_VEHICULOS PARA CONTROLAR LOS VEHICULOS QUE ENTRAN Y SALEN 

CREATE TABLE HISTORICO_VEHICULOS
(ID NUMBER(10) GENERATED AS IDENTITY NOT NULL, 
 ID_VEHICULO_NUEVO NUMBER(10),
 ID_VEHICULO_USADO NUMBER(10),
 ID_FACTURA NUMBER(10),
 "FECHA" DATE NOT NULL ENABLE, 
 ESTADO VARCHAR(10),
 CONSTRAINT HISTORICO_PK PRIMARY KEY (ID));

SE CREAR TRIGGER PARA ACTUALIZAR EL LOG CUANDO INGRESE VEHICULO NUEVO

CREATE OR REPLACE TRIGGER "TR_UPDATE_HISTORY" 
  AFTER INSERT ON VEHICULOS_NUEVOS
  FOR EACH ROW
BEGIN     
  Insert into HISTORICO_VEHICULOS(ID,ID_VEHICULO_NUEVO,ID_VEHICULO_USADO,ID_FACTURA,BILL_CLIENTE,FECHA,ESTADO) 
  VALUES (HISTORICO_VEHICULOS_SEQUENCE.NEXTVAL,:new.id,0,0,0,SYSDATE,'NUEVO') ;
END; 


Insert into VEHICULOS_NUEVOS (VIN,ID_MARCA,MODELO,ID_FABRICA,ESTADO) 
values ('2655','08','2017','7','NUEVO');



SE ADICIONA EL CAMPO BILL_CLIENTE PARA TENER CONTROL DEL CLIENTE CON EL QUE SE NEGOCIÃ“ EL VEHICULO EN PARTE DE PAGO 

ALTER TABLE HISTORICO_VEHICULOS
ADD BILL_CLIENTE NUMBER(12);


SE CREA TRIGGER PARA ACTUALIZAR EL LOG CUANDO INGRESE VEHICULO USADO

CREATE OR REPLACE TRIGGER "TR_UPDATE_HISTORY_VU" 
  AFTER INSERT ON VEHICULOS_USADOS
  FOR EACH ROW
BEGIN     
  Insert into HISTORICO_VEHICULOS(ID_VEHICULO_NUEVO,ID_VEHICULO_USADO,ID_FACTURA,BILL_CLIENTE,FECHA,ESTADO) 
  VALUES (0,:new.id,0,:new.ID_VEHICULO_CLIENTE,SYSDATE,'USADO') ;
END; 



Insert into VEHICULOS_USADOS (VIN,ID_MARCA,MODELO,ID_FABRICA,ESTADO,ID_VEHICULO_CLIENTE) 
values ('800001','20','2018','7','USADO','3');


SE CREA TRIGGER PARA ACTUALIZAR EL LOG CUANDO SE REALICE LA VENTA DE UN VEHICULO NUEVO O USADO 

CREATE OR REPLACE TRIGGER "TR_UPDATE_HISTORY_FACTURAS" 
  AFTER INSERT ON FACTURAS
  FOR EACH ROW
DECLARE
   v_VehiculoN number(10);
   v_VehiculoU number(10);
   Estado Varchar2(10);
   
BEGIN 
  If (:new.Id_Vehiculo_Nuevo<>0 ) then
     v_VehiculoN := :new.Id_Vehiculo_Nuevo;
     Estado:='NUEVO';
  Else 
     v_VehiculoN :=0;
     Estado:='NUEVO';
  End If;
  
  If (:new.Id_Vehiculo_usado<>0) Then
    v_VehiculoU:= :new.Id_Vehiculo_usado;
    Estado:='USADO';
  Else
    v_VehiculoU:=0;
    Estado:='USADO';
  End If;
  
  Insert into HISTORICO_VEHICULOS(ID_VEHICULO_NUEVO,ID_VEHICULO_USADO,ID_FACTURA,BILL_CLIENTE,FECHA,ESTADO) 
  VALUES (v_VehiculoN,v_VehiculoU,:new.NRO_FACTURA,:new.ID_CLIENTE,SYSDATE,Estado) ;
END; 



Insert into FACTURAS (NRO_FACTURA,ID_CLIENTE,ID_VENDEDOR,ID_VEHICULO_NUEVO,ID_VEHICULO_USADO,
VALOR_NEGOCIACION,FECHA,SUBTOTAL,IMPUESTOS,TOTAL) 
values ('1000000036','50','10',0,'13','15000000',to_date('09/07/17','DD/MM/RR'),'25000000','245000','25245000');



Insert into FACTURAS (NRO_FACTURA,ID_CLIENTE,ID_VENDEDOR,ID_VEHICULO_NUEVO,ID_VEHICULO_USADO,
VALOR_NEGOCIACION,FECHA,SUBTOTAL,IMPUESTOS,TOTAL) 
values ('1000000036','50','10',0,'18','25000000',to_date('18/11/17','DD/MM/RR'),'25000000','245000','25245000');

